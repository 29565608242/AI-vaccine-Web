(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-361d9a66"],{"323d":function(e,t,i){"use strict";i("5709")},5709:function(e,t,i){},"5b81":function(e,t,i){"use strict";var l=i("23e7"),a=i("c65b"),n=i("e330"),o=i("1d80"),r=i("1626"),s=i("7234"),c=i("44e7"),d=i("577e"),u=i("dc4a"),p=i("90d8"),m=i("0cb2"),h=i("b622"),f=i("c430"),g=h("replace"),b=TypeError,y=n("".indexOf),v=n("".replace),w=n("".slice),x=Math.max,_=function(e,t,i){return i>e.length?-1:""===t?i:y(e,t,i)};l({target:"String",proto:!0},{replaceAll:function(e,t){var i,l,n,h,$,S,k,T,L,F=o(this),U=0,C=0,O="";if(!s(e)){if(i=c(e),i&&(l=d(o(p(e))),!~y(l,"g")))throw b("`.replaceAll` does not allow non-global regexes");if(n=u(e,g),n)return a(n,e,F,t);if(f&&i)return v(d(F),e,t)}h=d(F),$=d(e),S=r(t),S||(t=d(t)),k=$.length,T=x(1,k),U=_(h,$,0);while(-1!==U)L=S?d(t($,U,h)):m($,h,U,[],void 0,t),O+=w(h,C,U)+L,C=U+k,U=_(h,$,U+T);return C<h.length&&(O+=w(h,C)),O}})},"750c":function(e,t,i){},"8a3a":function(e,t,i){"use strict";i.d(t,"e",(function(){return a})),i.d(t,"d",(function(){return n})),i.d(t,"a",(function(){return o})),i.d(t,"g",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c})),i.d(t,"f",(function(){return d}));var l=i("b775");function a(e){return Object(l["a"])({url:"/medical/peptide/list",method:"get",params:e})}function n(e){return Object(l["a"])({url:"/medical/peptide/"+e,method:"get"})}function o(e){return Object(l["a"])({url:"/medical/peptide",method:"post",data:e})}function r(e){return Object(l["a"])({url:"/medical/peptide",method:"put",data:e})}function s(e){return Object(l["a"])({url:"/medical/peptide/"+e,method:"delete"})}function c(e){return Object(l["a"])({url:"/medical/peptide/dnaChange",method:"post",data:e,timeout:6e5})}function d(e){return Object(l["a"])({url:"/medical/peptide/tcrChange",method:"post",data:e,timeout:6e5})}},d211:function(e,t,i){"use strict";i("750c")},dfac:function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"TCR氨基酸序列","label-width":"120px",prop:"hla"}},[i("el-input",{attrs:{placeholder:"请输入TCR氨基酸序列",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.hla,callback:function(t){e.$set(e.queryParams,"hla",t)},expression:"queryParams.hla"}})],1),i("el-form-item",{attrs:{label:"多肽",prop:"peptide"}},[i("el-input",{attrs:{placeholder:"请输入多肽序列",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.peptide,callback:function(t){e.$set(e.queryParams,"peptide",t)},expression:"queryParams.peptide"}})],1),i("el-form-item",{attrs:{label:"预测模型类型","label-width":"100px",prop:"modelType"}},[i("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择预测模型类型",clearable:""},model:{value:e.queryParams.modelType,callback:function(t){e.$set(e.queryParams,"modelType",t)},expression:"queryParams.modelType"}},e._l(e.dict.type.sys_model,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"是否突变",prop:"changeFlag"}},[i("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择是否突变",clearable:""},model:{value:e.queryParams.changeFlag,callback:function(t){e.$set(e.queryParams,"changeFlag",t)},expression:"queryParams.changeFlag"}},e._l(e.dict.type.sys_change,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")]),i("el-button",{class:e.className,attrs:{type:"info",icon:e.iconName,plain:"",size:"mini"}},[e._v("运行状态")])],1)],1),i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("删除")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleExport}},[e._v("导出")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleDownload}},[e._v("下载模板")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-upload",size:"mini"},on:{click:e.handleUpload}},[e._v("上传")])],1),i("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.peptideList},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),i("el-table-column",{attrs:{fixed:"",label:"TCR氨基酸序列",width:"400px",align:"center",prop:"hla"}}),i("el-table-column",{attrs:{fixed:"",label:"抗原氨基酸序列",width:"300px",align:"center",prop:"peptide"}}),i("el-table-column",{attrs:{label:"亲合度标签",width:"150px",align:"center",prop:"yPred"}}),i("el-table-column",{attrs:{label:"蛋白质链号",width:"150px",align:"center",prop:"chainNum"}}),i("el-table-column",{attrs:{label:"起始残基序号",width:"150px",align:"center",prop:"startNum"}}),i("el-table-column",{attrs:{label:"预测模型类型",width:"150px",align:"center",prop:"modelType"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.sys_model,value:t.row.modelType}})]}}])}),i("el-table-column",{attrs:{label:"模型预测概率",sortable:"",width:"150px",align:"center",prop:"yProb"}}),i("el-table-column",{attrs:{label:"是否已突变",width:"150px",align:"center",prop:"changeFlag"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.sys_change,value:t.row.changeFlag}})]}}])}),i("el-table-column",{attrs:{fixed:"right",width:"300px",label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.changeFlag?i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-view"},on:{click:function(i){return e.handleSeeChange(t.row)}}},[e._v("查看变异序列")]):e._e(),i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除")]),i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-view"},on:{click:function(i){return e.viewGraph(t.row)}}},[e._v("查看热力图")]),1!==t.row.changeFlag?i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){return e.dnaChange(t.row)}}},[i("svg-icon",{attrs:{"icon-class":"DNA"}}),e._v("突变")],1):e._e()]}}])})],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),i("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"HLA",prop:"hla"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.form.hla,callback:function(t){e.$set(e.form,"hla",t)},expression:"form.hla"}})],1),i("el-form-item",{attrs:{label:"多肽",prop:"peptide"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.form.peptide,callback:function(t){e.$set(e.form,"peptide",t)},expression:"form.peptide"}})],1),i("el-form-item",{attrs:{label:"亲和力",prop:"binding"}},[i("el-input",{attrs:{placeholder:"请输入亲和力"},model:{value:e.form.binding,callback:function(t){e.$set(e.form,"binding",t)},expression:"form.binding"}})],1),i("el-form-item",{attrs:{label:"预测值",prop:"prediction"}},[i("el-input",{attrs:{placeholder:"请输入预测值"},model:{value:e.form.prediction,callback:function(t){e.$set(e.form,"prediction",t)},expression:"form.prediction"}})],1),i("el-form-item",{attrs:{label:"得分",prop:"score"}},[i("el-input",{attrs:{placeholder:"请输入得分"},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),i("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),i("el-dialog",{attrs:{title:e.title,visible:e.upload,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.upload=t}}},[i("el-form",{ref:"uploadForm",attrs:{model:e.uploadForm,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"上传文件"}},[i("my-file-upload-tcr",{ref:"myFileUpload",attrs:{"file-type":e.fileType,"file-size":e.fileSize,limit:e.limit,"model-id":e.form.modelId},on:{processing:e.processing,processSuccess:e.getList}})],1),i("el-form-item",{attrs:{label:"选择模型"}},[i("el-select",{attrs:{placeholder:"请选择模型"},model:{value:e.form.modelId,callback:function(t){e.$set(e.form,"modelId",t)},expression:"form.modelId"}},e._l(e.dict.type.sys_model,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:parseInt(e.value)}})})),1)],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.submitUpload}},[e._v("预 测")]),i("el-button",{on:{click:e.cancelUpload}},[e._v("取 消")])],1)],1),i("el-drawer",{attrs:{title:e.title,visible:e.drawer,direction:e.direction,size:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.drawer=t}}},[i("div",{staticStyle:{padding:"20px"}},[i("thermodynamic-chart",{attrs:{width:"100%",height:"600px","chart-data":e.chartData}})],1)])],1)},a=[],n=i("c7eb"),o=i("1da1"),r=i("5530"),s=(i("d81d"),i("14d9"),i("ac1f"),i("5319"),i("5b81"),i("8a3a")),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload-file"},[i("el-upload",{ref:"fileUpload",staticClass:"upload-file-uploader",attrs:{multiple:"",action:e.realUploadFileUrl,"before-upload":e.handleBeforeUpload,"file-list":e.fileList,limit:e.limit,"on-error":e.handleUploadError,"on-exceed":e.handleExceed,"on-success":e.handleUploadSuccess,"on-change":e.handleChange,"show-file-list":!1,headers:e.headers,"auto-upload":!1}},[i("el-button",{attrs:{size:"mini",type:"primary"}},[e._v(e._s(e.tip))]),e.showTip?i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 请上传 "),e.fileSize?[e._v(" 大小不超过 "),i("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.fileSize)+"MB")])]:e._e(),e.fileType?[e._v(" 格式为 "),i("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.fileType.join("/")))])]:e._e(),e._v(" 的文件 ")],2):e._e()],1),i("transition-group",{staticClass:"upload-file-list el-upload-list el-upload-list--text",attrs:{name:"el-fade-in-linear",tag:"ul"}},e._l(e.fileList,(function(t,l){return i("li",{key:t.uid,staticClass:"el-upload-list__item ele-upload-list__item-content"},[i("span",{staticClass:"el-icon-document"},[e._v(" "+e._s(e.getFileName(t.name))+" ")]),i("div",{staticClass:"ele-upload-list__item-content-action"},[i("el-link",{attrs:{underline:!1,type:"danger"},on:{click:function(t){return e.handleDelete(l)}}},[e._v("删除")])],1)])})),0)],1)},d=[],u=(i("a9e3"),i("b0c0"),i("a15b"),i("a434"),i("99af"),i("fb6a"),i("5f87")),p={name:"MyFileUpload",props:{value:[String,Object,Array],limit:{type:Number,default:5},tip:{type:String,default:"选取文件"},modelId:{type:Number,default:0},fileSize:{type:Number,default:5},fileType:{type:Array,default:function(){return["doc","xls","ppt","txt","pdf"]}},isShowTip:{type:Boolean,default:!0}},data:function(){return{number:0,uploadList:[],baseUrl:"/prod-api",uploadFileUrl:"/prod-api/common/myUploadTcr/",headers:{Authorization:"Bearer "+Object(u["a"])()},fileList:[],autoUpload:!1}},watch:{value:{handler:function(e){if(!e)return this.fileList=[],[];var t=1,i=Array.isArray(e)?e:this.value.split(",");this.fileList=i.map((function(e){return"string"===typeof e&&(e={name:e,url:e}),e.uid=e.uid||(new Date).getTime()+t++,e}))},deep:!0,immediate:!0},modelId:{deep:!0,handler:function(e){this.realUploadFileUrl=this.uploadFileUrl+e}}},computed:{showTip:function(){return this.isShowTip&&(this.fileType||this.fileSize)},realUploadFileUrl:function(){return this.uploadFileUrl+this.modelId}},methods:{handleBeforeUpload:function(e){if(this.fileType){var t=e.name.split("."),i=t[t.length-1],l=this.fileType.indexOf(i)>=0;if(!l)return this.$modal.msgError("文件格式不正确, 请上传".concat(this.fileType.join("/"),"格式文件!")),!1}if(this.fileSize){var a=e.size/1024/1024<this.fileSize;if(!a)return this.$modal.msgError("上传文件大小不能超过 ".concat(this.fileSize," MB!")),!1}return this.$modal.loading("正在上传文件，请稍候..."),this.number++,!0},handleChange:function(e,t){this.fileList=t,console.log(this.fileList)},handleExceed:function(){this.$modal.msgError("上传文件数量不能超过 ".concat(this.limit," 个!"))},handleUploadError:function(e){this.$modal.msgError("上传文件失败，请重试"),this.$modal.closeLoading()},handleUploadSuccess:function(e,t){200===e.code?(this.uploadList.push({name:e.originalFilename,url:e.fileName}),this.uploadedSuccessfully()):(this.number--,this.$modal.closeLoading(),this.$modal.msgError(e.msg),this.$refs.fileUpload.handleRemove(t),this.uploadedSuccessfully())},handleDelete:function(e){this.fileList.splice(e,1),this.$emit("input",this.listToString(this.fileList))},reset:function(){this.fileList=[]},uploadedSuccessfully:function(){this.number>0&&this.uploadList.length===this.number&&(this.fileList=this.fileList.concat(this.uploadList),this.uploadList=[],this.number=0,this.$emit("input",this.listToString(this.fileList)),this.$modal.closeLoading())},getFileName:function(e){return e.lastIndexOf("/")>-1?e.slice(e.lastIndexOf("/")+1):e},listToString:function(e,t){var i="";for(var l in t=t||",",e)i+=e[l].name+t;return""!=i?i.substr(0,i.length-1):""},submit:function(e){if(0===this.fileList.length)this.$message({type:"warning",message:"请先上传文件！"});else if(null===e)this.$message({type:"warning",message:"请选择模型！"});else{this.$refs.fileUpload.submit(),this.$modal.closeLoading();var t=this;this.$emit("processing"),setTimeout((function(){t.$emit("processSuccess")}),1e3)}}}},m=p,h=(i("323d"),i("2877")),f=Object(h["a"])(m,c,d,!1,null,"5d584aa7",null),g=f.exports,b=i("fef8"),y=i("b775"),v={name:"Peptide",dicts:["sys_model","sys_change"],components:{ThermodynamicChart:b["default"],MyFileUploadTcr:g},data:function(){return{loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,peptideList:[],title:"",open:!1,upload:!1,queryParams:{pageNum:1,pageSize:10,hla:null,isTcr:1,peptide:null,binding:null,prediction:null,score:null,thermodynamic:null},fileType:["csv"],fileSize:5,limit:1,form:{modelId:1},rules:{},uploadForm:{filePath:null},drawer:!1,direction:"rtl",chartData:{},className:"",iconName:""}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,this.upload=!1,this.className="",this.iconName="el-icon-video-play",this.$set(this.queryParams,"isTcr",1),Object(s["e"])(this.queryParams).then((function(t){e.peptideList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={id:null,hla:null,peptide:null,binding:null,prediction:null,score:null,thermodynamic:null,createBy:null,createTime:null,updateBy:null,updateTime:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},handleUpload:function(){this.upload=!0,this.title="上传文件"},cancelUpload:function(){this.upload=!1,this.resetForm("uploadForm"),this.form.modelId="",this.form.modelPath="",this.$refs.myFileUpload.reset()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.id})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加记录"},handleSeeChange:function(e){this.$router.push({path:"/visitor/tcrMutation?id="+e.id})},submitForm:function(){var e=this;this.$refs["uploadForm"].validate((function(t){t&&(null!=e.form.id?Object(s["g"])(e.form).then((function(t){e.$modal.msgSuccess("修改成功"),e.open=!1,e.getList()})):Object(s["a"])(e.form).then((function(t){e.$modal.msgSuccess("新增成功"),e.open=!1,e.getList()})))}))},submitUpload:function(){this.$refs.myFileUpload.submit(this.form.modelId)},handleDelete:function(e){var t=this,i=e.id||this.ids;this.$modal.confirm("是否确认删除该TCR氨基酸序列").then((function(){return Object(s["b"])(i)})).then((function(){t.getList(),t.$notify({title:"成功",message:"删除成功",type:"success"})})).catch((function(){}))},handleExport:function(){this.$set(this.queryParams,"isTcr",1),this.download("medical/peptide/export",Object(r["a"])({},this.queryParams),"peptide_".concat((new Date).getTime(),".xlsx"))},viewGraph:function(e){console.log(e);for(var t=e.xAxis.substring(1,e.xAxis.length-1).split(","),i=e.yAxis.substring(1,e.yAxis.length-1).split(","),l=e.thermodynamic,a=l.split("],"),n=[],o=0;o<a.length;o++){var r=a[o].replaceAll("[","").replaceAll(" ","").split(","),s=[parseInt(r[0]),parseInt(r[1]),parseFloat(r[2])];n.push(s)}this.$set(this.chartData,"data",n),this.$set(this.chartData,"xdata",t),this.$set(this.chartData,"ydata",i),this.$set(this.chartData,"max",e.maxValue),this.$set(this.chartData,"min",e.minValue),this.drawer=!0,this.title="热力图"},handleDownload:function(){Object(y["b"])("/medical/peptide/downloadTcpTemplate/","","模板文件.csv")},handleClose:function(e){this.drawer=!1},processing:function(){this.upload=!1,this.className="blue-button",this.iconName="el-icon-video-pause"},dnaChange:function(e){var t=this;return Object(o["a"])(Object(n["a"])().mark((function i(){var l,a,o;return Object(n["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return l=e.id,t.$modal.loading("模型处理中，请稍候..."),i.next=4,Object(s["d"])(l);case 4:a=i.sent,o=a.data,t.form=o,Object(s["f"])(t.form).then((function(e){t.getList(),t.$modal.closeLoading(),t.$notify({title:"成功",message:"TCR氨基酸序列已突变",type:"success"})})).catch((function(e){t.$modal.closeLoading(),475===e.code&&t.$message({message:e.msg,type:"warning"})}));case 8:case"end":return i.stop()}}),i)})))()}}},w=v,x=(i("d211"),Object(h["a"])(w,l,a,!1,null,"0135f0b7",null));t["default"]=x.exports}}]);